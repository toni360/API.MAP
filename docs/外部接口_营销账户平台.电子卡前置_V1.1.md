
#1目的

该文档是营销账户平台对外开放接口文档，用于对外开放开卡、同步支付记录等能力。


#2接口

##2.1开卡系列接口

###2.1.1 获取短信验证码接口

在开卡前，第三方应用系统可以使用该接口向需要开卡的手机号码发送短信验证码，用于验证手机号码的真实性。

1）请求说明

http请求方式: post

    http://IP:PORT/front/oilcard/get_smscode



POST数据格式：JSON

    {
        "account":"jiayouka", "timeStamp":"TIMESTAMP", "nonce":"NONCE", "signature":"SIGNATURE", "mobileNum":"13912345678"
    }  

参数|必须|说明
-------|------|-------
account|是|发送短信帐号
timeStamp|是|时间戳
nonce|是|随机数
signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(account, password, nonce, timeStamp))，password为中经汇通分配，参与MD5运算
mobileNum|是|需要验证码的手机号码


2）返回说明

正常时的返回JSON数据包示例：

    {"errcode":0,"errmsg":"已经发送短信验证码"}

错误时的JSON数据包示例：

    {"errcode":10000,"errmsg":"发送短信验证码失败，其它原因"}

###2.1.2开卡接口

第三方应用系统可以使用该接口，为用户开通加油卡。

1）请求说明

前置条件：必须先执行获取短信验证码接口

http请求方式: post

    http://IP:PORT/front/oilcard/open?channel=C001


POST数据格式：JSON

    {
        "ID":"515411244445444444X", "name":"李四", "mobileNum":"13912345678", "smsCode":"4567", "channelOrderId":"channel1234567890"
    }


参数|必须|说明
------|------|-------
channel|是|渠道编码
ID|是|身份证号
name|是|姓名
mobileNum|是|开卡手机号码
smsCode|是|通过短信获取到的验证码
channelOrderId|是|渠道自定义订单号，用于异常时，查询开卡结果

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"用户开卡成功",
        "card":{
            "accountId":"1234123412341234",
            "amount":500000,
            "availableBalance":300000,
            "stage":3,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"用户开卡失败，其它错误",
    }

参数|必须|说明
----|----|----
accountId|是|卡号
amount|是|加油卡总额
availableBalance|是|加油卡可用余额
stage|是|分期数
startTime|是|开始日期
endTime|是|结束日期



###2.1.3查询开卡结果接口

第三方应用系统可以使用该接口，为用户开通加油卡。

1）请求说明

前置条件：必须先执行获取短信验证码接口

http请求方式: post

    http://IP:PORT/front/oilcard/open?channel=C001


POST数据格式：JSON

    {
        "channelOrderId":"channel1234567890"
    }


参数|必须|说明
------|------|-------
channel|是|渠道编码
channelOrderId|是|渠道订单号


2）返回说明

正常时的返回JSON数据包示例：

    {
        "card":{
            "accountId":"1234123412341234",
            "amount":500000,
            "availableBalance":300000,
            "stage":3,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"用户开卡失败，其它错误",
    }

参数|必须|说明
----|----|----
accountId|是|卡号
amount|是|加油卡总额
availableBalance|是|加油卡可用余额
stage|是|分期数
startTime|是|开始日期
endTime|是|结束日期


###2.1.4同步线下开卡信息接口

该接口仅提供给联通优势，将开卡信息同步给联通优势系统。

1）请求说明



http请求方式: post

    http://URL/front/oilcard/notify

>note:
>联通优势提供URL地址

POST数据格式：JSON

    {
        "posCode":"ZJ0008",
        "card":{
            "accountId":"1234123412341234",
            "amount":500000,
            "availableBalance":300000,
            "stage":3,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
        }
    }


参数|必须|说明
------|------|-------
posCode|是|POS机编码
accountId|是|卡号
amount|是|加油卡总额
availableBalance|是|加油卡可用余额
stage|是|分期数
startTime|是|开始日期
endTime|是|结束日期


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0, "errmsg":"同步线下开卡信息成功"   
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"同步线下开卡信息失败，其它错误",
    }


##2.2线下支付系列接口

##2.2.1线下支付接口

该接口仅供中经汇通POSP调用，用于在中经汇通POS机上完成线下支付。

1）请求说明


http请求方式: post

    http://IP:PORT/front/pay/offline


POST数据格式：JSON

    {
        "order":{
            "mobileNum":"13912345678",
            "paymentCodeMD5":"231EEREWQR",
            "sum":5000,
            "sellerId":"SH12345",
            "posCode":"ZJ000001",
            "remark":"",
            "productName":""
        }
    }


参数|必须|说明
------|------|-------
mobileNum|是|开卡手机号码
paymentCodeMD5|是|支付密码MD5值
sum|是|支付金额
sellerId|是|商户代码
posCode|否|POS机编码
remark|否|备注
productName|否|支付商品名称

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"支付成功", 
        "order":{
            "orderId":"ud12345678901234567890"
            "mobileNum":"13912345678",
            "sum":5000,
            "payTime":"2015-01-02 12:12:00"
            "sellerId":"SH12345",
            "posCode":"ZJ000001",
            "remark":"",
            "productName":""           
            "status":"支付成功"
        }
        "card":{
            "accountId":"1234123412341234",
            "amount":500000,
            "availableBalance":300000,
            "stage":3,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"支付失败，其它错误",
    }

参数|必须|说明
----|----|----
mobileNum|是|开卡手机号码
paymentCodeMD5|是|支付密码MD5值
sum|是|支付金额
sellerId|是|商户代码
posCode|否|POS机编码
remark|否|备注
productName|否|支付商品名称
orderId|是|交易流水号
payTime|是|交易时间
status|是|状态
accountId|是|卡号
amount|是|加油卡总额
availableBalance|是|加油卡可用余额
stage|是|分期数
startTime|是|加油卡开始日期
endTime|是|加油卡结束日期



###2.2.2同步线下支付订单接口

该接口仅提供给联通优势，将线下支付订单信息同步给联通优势系统。

1）请求说明



http请求方式: post

    http://URL/front/pay/notify

>note:
>联通优势提供URL地址

POST数据格式：JSON

    {
        "order":{
            "orderId":"ud12345678901234567890"
            "mobileNum":"13912345678",
            "sum":5000,
            "payTime":"2015-01-02 12:12:00"
            "sellerId":"SH12345",
            "posCode":"ZJ000001",
            "remark":"",
            "productName":""           
            "status":"支付成功"
        }
    }


参数|必须|说明
------|------|-------
mobileNum|是|开卡手机号码
paymentCodeMD5|是|支付密码MD5值
sum|是|支付金额
sellerId|是|商户代码
posCode|否|POS机编码
remark|否|备注
productName|否|支付商品名称
orderId|是|交易流水号
payTime|是|交易时间
status|是|状态


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0, "errmsg":"同步线下支付订单信息成功"   
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"同步线下支付订单信息失败，其它错误",
    }


#3对账

#3.1开户对账

对账文件格式

手机号码|卡号|开户时间|状态
>备注
>状态是0时，代表成功，1时代表失败。

例子

13912345678|1234123412341234|2015-01-01 12:12:00|0
13912345678|5678567856785678|2015-01-01 12:12:00|1



#3.2消费对账

对账文件格式

订单号|手机号码|支付金额|交易商户|支付时间|状态
>备注
>状态是0时，代表成功，1时代表失败。

例子

ud1234567890|13912345678|50|SH0001|2015-01-01 12:12:00|0
UD2345678900|13912345678|60|SH0002|2015-01-01 12:12:00|1