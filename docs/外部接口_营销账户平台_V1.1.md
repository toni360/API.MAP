
#目的

该文档是营销账户平台第二阶段，即V1.1版本对外开放接口文档，新增分期电子卡账户等能力.

#消费号码（consumerId）编码规则

即账户号码编码规则

为了更好满足移动互联网的消费需求，特别对电子卡、现金账户、投资账户等进行统一账户编码。

- 统一采用16位数字编码，出了”1X“开头的账户编码例外，"1X"开头账户编码12位，为手机号码
- 编码规则说明：

AABB CCCD DDDD DDDD

其中：

AA：代表账户类型。

AA|账户类型
---|---
1X|手机号码，总长度12位数字
95|现金账户，总长度16位数字
97|投资账户，总长度16位数字
20|分期卡账户，总长度16位数字
26|折扣卡账户，总长度16位数字


BB：代表某账户下的产品形态，比如01表示1000元套餐，02标识2000元套餐呢。

AABB：组合形成了一个具体的产品编码，比如2201就表示分期电子卡1000元套餐。

CCC：表示发行地点，一般采用区域的电话号码前缀，比如深圳发行就是755，888或者020代表总部发行。

D DDDD DDDD：表示自动生成的账户数字，某个产品编号下的某个地方发行的可以容纳近亿个账号。



#接口

##分期卡账户

为了方便和前面的文档对应，分期卡采用oilcard标识。

###线上开卡接口

外围应用系统可以使用该接口，为用户在线开通加油卡。

1）请求说明

前置条件：必须先执行获取短信验证码接口

http请求方式: post

    http://IP:PORT/gw/oilcard/open_online


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},  
        "order":
            {
                "ID":"515411244445444444X", 
                "name":"李四", 
                "mobileNum":"13912345678", 
                "smsCode":"4567", 
                "channelOrderId":"channel1234567890",
                "channelNo":"channel001",
                "appOrderId":"123456789",
                "productId":"10",
                "remark":"某某渠道为用户13912345678开卡"},
        "tsig":
            {"orderMD5":"ORDERMD5","signature":"SIGNATURE", "timeStamp":"TIMESTAMP","nonce":"NONCE"}
    }  


参数|是否必须|说明
----|----|-----
appId|是|营销账户平台统一分配的appId
app.timeStamp|否|时间戳
app.nonce|否|随机数
app.signature|否|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
channelNo|是|渠道编码，中经汇通分配，这里仅作为记录
ID|是|身份证号，用3des算法加密，秘钥为appKey，base64编码
name|是|姓名，用3des算法加密，秘钥为appKey，base64编码
mobileNum|是|开卡手机号码，用3des算法加密，秘钥为appKey，base64编码
productId|是|产品编码
smsCode|是|通过短信获取到的验证码
channelOrderId|是|渠道自定义订单号，用于异常时，查询开卡结果
remark|是|备注
appOrderId|是|app自定义订单号，最大支持128个字符
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(channelNo, ID, name, mobileNum, channelOrderId, remark, appOrderId, productId))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"用户开卡成功",
        "orderId":"12345678901234567890",
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "restAmount":40000,
            "balance":300000,
            "totalStages":3,
            "restStages":3,
            "returnSum":100000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"用户开卡失败，其它错误",
    }

参数|必须|说明
----|----|----
orderId|是|订单号，有map系统返回
accountId|是|卡号
amount|是|卡总面额
restAmount|是|卡剩余总额
balance|是|卡当前可用金额
totalStages|是|分期总数
restStage|是|剩余分期数
returnSum|是|分期返还金额
startTime|是|有效期-开始日期
endTime|是|有效期-结束日期
status|是|状态，正常、冻结


###查询开分期卡结果接口

当开卡出现异常的时候，前置系统可以使用该接口，检查开卡是否成功。

1）请求说明


http请求方式: post

    http://IP:PORT/front/oilcard/get


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},  
        "appOrderId":"1234567890"        
    }


参数|必须|说明
------|------|-------
appOrderId|是|需要查询开分期卡结果的应用订单号，由于系统异常，第三方应用系统可能未接收到我方后台返回的订单号，因此采用第三方订单号查询，因此请第三方系统保证该值得唯一性。


2）返回说明

正常时的返回JSON数据包示例：

    {
        "orderId":"12345678901234567890",
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "restAmount":40000,
            "balance":300000,
            "totalStages":3,
            "restStages":3,
            "returnSum":100000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"没有查找到对应的分期卡订单，其它错误"
    }

参数|必须|说明
----|----|----
orderId|是|开卡的订单号
accountId|是|分期卡卡号
amount|是|分期卡面额，单位：分
restAmount|是|分期卡剩余面额，单位：分
balance|是|分期卡当前可用金额，单位：分
totalStages|是|分期总数
restStage|是|剩余分期数
returnSum|是|分期金额，单位：分
startTime|是|有效期-开始日期
endTime|是|有效期-结束日期
status|是|状态，正常、冻结



###转账（到现金账户）接口
外围应用系统将分期卡账户中的可用金额转出到现金账户，调用该接口完成。

1）请求说明


http请求方式: post


    http://IP:PORT/gw/oilcard/transfer_to_cashAccount

POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},  
        "order":
            {"mobileNum":"13912345678","accountId":"1234123412341234","sum":500000,"remark":"从分期卡账户转账5000元到现金账户", "appOrderId":"AO201412122344888444", "accountCode":"231435","paymentCodeMD5":"w344dioeorreeoocWRT"},
        "tsig":
            {"orderMD5":"ORDERMD5","signature":"SIGNATURE", "timeStamp":"TIMESTAMP","nonce":"NONCE"}
    }  


参数|必须|说明
------|------|-------
appId|是|营销账户平台统一分配的appId
app.timeStamp|是|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
mobileNum|是|用户手机号码
accountId|是|分期卡卡号
accountCode|否|账户验证码
paymentCodeMD5|否|交易密码
sum|是|金额
remark|是|备注
appOrderId|是|app自定义订单号，最大支持128个字符
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(mobileNum,accountId,remark,appOrderId,sum,accountCode,paymentCodeMD5))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"从分期卡账户转账到现金账户成功",
        "orderId":"ud12345678901234567890",
        "account":{
            "accountId":"1234123412341234",
            "balance":300000,
            "status":"正常"
        },
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "restAmount":40000,
            "balance":300000,
            "totalStages":3,
            "restStages":3,
            "returnSum":100000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
      }

错误时的JSON数据包示例：

    {"errcode":4340,"errmsg":"从分期卡账户转账到现金账户失败，其它错误"}

参数|必须|说明
---|---|---
orderId|否|营销账户平台返回的成功订单流水号
accountId|是|卡号
amount|是|面额，单位：分
restAmount|是|剩余面额，单位：分
balance|是|当前可用金额，单位：分
totalStages|是|分期总数
restStage|是|剩余分期数
returnSum|是|分期返还金额，单位：分
startTime|是|有效期-开始日期
endTime|是|有效期-结束日期
card.status|是|状态，正常、冻结


##线下系列接口

###线下支付接口

当在pos上消费时，由前置系统调用，完成线下支付过程。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/offline/pay

POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},
        "order":{
            "consumerId":"13912345678",
            "paymentCodeDES":"231EEREWQR",
            "sum":5000,
            "sellerId":"SH12345",
            "storeId":"ST12345",
            "terminalId":"ZJ000001",
            "operatorId":"zhangsan",
            "batchNo":"123123123122132",
            "terminalOrderId":"1234567890123456789",
            "productName":"0号柴油",
            "productPrice":500,
            "productQuantity":"1.55",
            "appOrderId":"1234567890"
        }
        "tsig":
            {"orderMD5":"ORDERMD5","signature":"SIGNATURE","timeStamp":"TIMESTAMP","nonce":"NONCE"}
    }  


参数|必须|说明
------|------|-------
appId|是|营销账户平台统一分配的appId
app.timeStamp|是|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
consumerId|是|消费号码，可以是手机号码，或者是卡号
paymentCodeDES|是|加密的支付密码
sum|是|支付金额，单位：分
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
terminalOrderId|是|终端订单流水号
batchNo|是|批次号
productName|否|商品编码，比如0号柴油
productPrice|否|商品价格，比如5.00元/升
productQuantity|否|商品数量，比如1.55升
remark|否|备注
appOrderId|否|app自定义订单号，最大支持128个字符
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(consumerId, paymentCodeDES, sum, sellerId, storeId, terminalId, operatorId, batchNo, terminalOrderId, productName, productPrice, productQuantity, remark, appOrderId, ))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"线下支付成功",
        "order":{
            "orderId":"ud12345678901234567890"
            "consumerId":"13912345678",
            "sum":5000,
            "payTime":"2015-01-02 12:12:00"
            "sellerId":"SH12345",
            "storeId":"ST12345",
            "terminalId":"ZJ000001",
            "operatorId":"zhangsan",
            "batchNo":"123123123122132",
            "terminalOrderId":"1234567890123456789",
            "productName":"0号柴油",
            "productPrice":500,
            "productQuantity":"1.55",
            "remark":"",
            "status":"支付成功"
        },
        "account":{
            "accountId":"1234123412341234",
            "balance":300000,
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {"errcode":10000,"errmsg":"线下支付失败，其它错误"}

参数|必须|说明
---|---|---
orderId|是|后台返回的交易订单号
consumerId|是|消费号码
sum|是|支付金额，单位：分
payTime|是|交易时间
status|是|状态
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
batchNo|是|批次号
terminalOrderId|是|终端流水号
productName|否|商品编码，比如0号柴油
productPrice|否|商品价格，比如5.00元/升
productQuantity|否|商品数量，比如1.55升
remark|否|备注
account.accountId|是|账户，即卡号
balance|是|油卡当前可用金额
account.status|是|状态，正常、冻结


###线下交易撤销接口

该接口用于营业员在中经汇通POS机上完成撤销功能。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/offline/pay_cancel


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},
         "order":{
            "orderId":"12345678900987654321",
            "sellerId":"SH12345",
            "storeId":"ST12345",
            "terminalId":"ZJ000001",
            "operatorId":"zhangsan",
            "batchNo":"123123123122132",
            "terminalOrderId":"1234567890123456789",
            "remark":"",
            "appOrderId":"12345678"
        }
       "tsig":{
            "orderMD5":"ORDERMD5","signature":"SIGNATURE","timeStamp":"TIMESTAMP","nonce":"NONCE"
        }
    }


参数|必须|说明
------|------|-------
appId|是|营销账户平台统一分配的appId
app.timeStamp|是|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
orderId|是|需要查询的终端流水号
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
terminalOrderId|是|终端订单流水号
batchNo|是|批次号
remark|否|备注
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(orderId, sellerId, storeId, terminalId, operatorId, remark, terminalOrderId, batchNo, appOrderId))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"交易撤销成功", 
        "order":{
            "orderId":"ud12345678901234567890",
            "consumerId":"13912345678",
            "payTime":"2015-01-02 12:12:00",
            "sellerId":"SH12345",
            "storeId":"ST12345",
            "terminalId":"ZJ000001",
            "operatorId":"zhangsan",
            "batchNo":"123123123122132",
            "terminalOrderId":"1234567890123456789",
            "remark":"",
            "status":"消费撤销成功",
            "appOrderId":"123456789"
        }
        "card":{
            "accountId":"1234123412341234",
            "balance":300000,
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"交易撤销失败，其它错误",
    }

参数|必须|说明
----|----|----
orderId|是|系统返回的交易订单号
consumerId|是|消费号码
sum|是|支付金额
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
batchNo|是|批次号
terminalOrderId|是|终端订单流水号
remark|否|备注
payTime|是|交易时间
status|是|状态
accountId|是|卡号
balance|是|油卡当前可用金额
account.status|是|状态，正常、冻结、锁定


###线下交易冲正接口

该接口用于中经汇通POS机在处理异常后自动发起的冲正功能。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/offline/pay_undo


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},
        "order":{
            "sellerId":"GM01",
            "storeId":"ST01",
            "terminalId":"POS12345",
            "operatorId":"zhangsan",
            "terminalOrderId":"1234567890",
            "batchNo":"123123123122132",
            "remark":"",
            "appOrderId":"123456789"
        }
       "tsig":{
            "orderMD5":"ORDERMD5","signature":"SIGNATURE","timeStamp":"TIMESTAMP","nonce":"NONCE"
        }
    }


参数|必须|说明
------|------|-------
appId|是|营销账户平台统一分配的appId
app.timeStamp|是|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
terminalOrderId|是|需要冲正的终端流水号
batchNo|是|批次号
remark|否|备注
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(sellerId, storeId, terminalId, operatorId, remark, terminalOrderId, batchNo, appOrderId))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"交易撤销成功", 
        "order":{
            "orderId":"ud12345678901234567890"
            "consumerId":"13912345678",
            "sum":5000,
            "payTime":"2015-01-02 12:12:00"
            "sellerId":"SH12345",
            "storeId":"ST12345",
            "terminalId":"ZJ000001",
            "operatorId":"zhangsan",
            "batchNo":"123123123122132"
            "terminalOrderId":"1234567890123456789",
            "productName":"0号柴油",
            "productPrice":500,
            "productQuantity":"1.55",
            "remark":"",
            "status":"支付失败，冲正成功",
            "appOrderId":"123456789"
        }
        "card":{
            "accountId":"1234123412341234",
            "balance":300000,
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"交易撤销失败，其它错误",
    }

参数|必须|说明
----|----|----
orderId|是|系统返回的交易订单号
consumerId|是|消费号码
sum|是|支付金额
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
terminalOrderId|是|终端订单流水号
batchNo|是|批次号
productName|否|商品编码，比如0号柴油
productPrice|否|商品价格，比如5.00元/升
productQuantity|否|商品数量，比如1.55升
remark|否|备注
payTime|是|交易时间
status|是|状态
appOrderId|是|应用订单号
accountId|是|卡号
balance|是|油卡当前可用金额
account.status|是|状态，正常、冻结


###线下查询余额接口

该接口用于营业员在中经汇通POS机上完成查询余额功能。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/offline/get_account_info


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},
        "query":{
            "consumerId":"13912345678",
            "sellerId":"GM01",
            "storeId":"ST01",
            "terminalId":"POS12345",
            "operatorId":"zhangsan",
            "terminalOrderId":"1234567890",
            "batchNo":"123123123122132",
            "remark":""
        }
    }


参数|必须|说明
------|------|-------
appId|是|营销账户平台统一分配的appId
app.timeStamp|是|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
consumerId|是|消费号码
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
batchNo|是|批次号
terminalOrderId|是|终端流水号
remark|否|备注

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"查询余额成功", 
        "card":{
            "accountId":"1234123412341234",
            "balance":300000,
            "status":"正常",
            "remark":""
        },
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"查询余额失败，其它错误",
    }

参数|必须|说明
----|----|----
accountId|是|账户号码
balance|是|油卡当前可用金额
endTime|是|油卡有效期-结束日期
status|是|状态

###线下开卡接口

外围应用系统可以使用该接口，为用户通过POS机开通分期卡，该接口返回成功后，不代表开卡成功，必须等待第二天交割后才能成功。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/offline/open_card


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},  
        "order":
            {
                "ID":"515411244445444444X", 
                "name":"李四", 
                "mobileNum":"13912345678", 
                "appOrderId":"1234567890",
                "sellerId":"SH01",
                "storeId":"ST01",
                "terminalId":"POS01",
                "batchNo":"1234567",
                "terminalOrderId":"1234567890",
                "productId":"10",
                "paySum":100000,
                "remark":"某某渠道为用户13912345678开卡"},
        "tsig":
            {"orderMD5":"ORDERMD5","signature":"SIGNATURE", "timeStamp":"TIMESTAMP","nonce":"NONCE"}
    }  


参数|是否必须|说明
----|----|-----
appId|是|营销账户平台统一分配的appId
app.timeStamp|否|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
ID|是|身份证号，用3des算法加密，秘钥为appKey，base64编码
name|否|姓名，用3des算法加密，秘钥为appKey，base64编码
mobileNum|是|开卡手机号码，用3des算法加密，秘钥为appKey，base64编码
productId|是|油卡账户产品类型
paySum|否|支付金额，仅用于对拆开支付的订单进行合并
remark|是|备注
appOrderId|是|app自定义订单号，最大支持128个字符
sellerId|是|商户编码
storeId|是|门店编码
terminalId|是|终端编码
batchNo|是|批次号
terminalOrderId|终端流水号
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(ID, name, mobileNum, appOrderId, sellerId, storeId, terminalId, batchNo, terminalOrderId, productId, remark))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"线下开卡成功",
        "order":{
            "orderId":"12345678901234567890",
            "mobileNum":"13912345678", 
            "sellerId":"SH01",
            "storeId":"ST01",
            "terminalId":"POS01",
            "operatorId":"001"
            "batchNo":"1234567",
            "terminalOrderId":"1234567890",
            "remark":""
        }
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"线下开卡失败，其它错误"
    }

    {
        "errcode":XXXXX,"errmsg":"支付金额匹配不到现有产品价格，需要交割时合并订单处理",
        "request":"RESQUEST"
    }

>特别说明
>1、XXXXX为MAP业务模块定义的返回值。
>2、前置对于XXXXX错误，不应该认为失败，应该保存该订单数据，对外部返回成功，等待交割时在进行订单合并处理。


参数|必须|说明
----|----|----
orderId|是|订单号，有map系统返回
mobileNum|是|开卡手机号码
sellerId|是|商户编码
storeId|是|是|门店编码
terminalId|是|终端编码
operatorId|是|操作员编码
batchNo|是|批次号
terminalOrderId|是|终端流水号，非唯一。当出现异常时，可以根据terminalId+batchNo+terminalOrderId唯一确定交易订单，进行后续的处理
accountId|是|卡号
amount|是|油卡面额
startTime|是|油卡有效期-开始日期
endTime|是|油卡有效期-结束日期
card.status|是|状态，正常、冻结

###线下开卡交割接口

仅提供给前置模块使用该接口，在接收到POSP交割文件后，发起请求，向MAP系统对线下开卡交割。

1）请求说明


http请求方式: post

    http://IP:PORT/gw/oilcard/open_offline_delivery


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"},  
        "order":[
            {"orderId":"123456789", "accountType":"OAC"},
            {"orderId":"123456789", "accountType":"DAC"},
            {"orderId":"123456789", "accountType":"DAC"},
            {"orderId":"123456789", "accountType":"OAC"},
            {"orderId":"123456789", "accountType":"OAC"},
            {"orderId":"123456789", "accountType":"DAC"},
            {"orderId":"123456789", "accountType":"DAC"}           
        ],
        "tsig":
            {"orderMD5":"ORDERMD5","signature":"SIGNATURE", "timeStamp":"TIMESTAMP","nonce":"NONCE"}
    }  


参数|是否必须|说明
----|----|-----
appId|是|营销账户平台统一分配的appId
app.timeStamp|否|时间戳
app.nonce|是|随机数
app.signature|是|签名值，MD5(按值的字典顺序排列组合成字符串(appId,appKey,app.nonce,app.timeStamp))
orderId|是|在线下开卡是返回的订单号，1次最大支持2000个订单交割
orderMD5|是|MD5签名值，MD5(按值的字典顺序排列组合成字符串(orderId, accountType))
tsig.signature|是|私钥签名值，signature((按值的字典顺序排列组合成字符串(orderMD5,appId,tsig.timeStamp,tsig.nonce))
tsig.timeStamp|是|时间戳
tsig.nonce|是|随机数


2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"接收线下开卡交割数据成功"
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"接收线下开卡交割数据失败，其它错误",
        "result":[
            {"orderId":"123456789", "errmsg":"订单不存在"},
            {"orderId":"123456789", "errmsg":"订单不一致"},
            {"orderId":"123456789", "errmsg":"订单不一致"}
        ],
    }

参数|是否必须|说明
----|----|-----
orderId|是|交割失败返回传入的订单号
errmsg|是|交割失败具体原因



###线下产品下载接口

用于POS机下载产品列表。

1）请求说明

http请求方式: post

    http://IP:PORT/front/offline/download_product


POST数据格式：JSON

    {
        "app":
            {"appId":"zjhtwallet","timeStamp":"TIMESTAMP", "nonce":"NONCE","signature":"SIGNATURE"}, 
        "download"{ 
            "sellerId":"SH01",
            "storeId":"ST01",
            "terminalId":"POS01",
            "batchNo":"1234567",
            "terminalOrderId":"1234567890"
        }
    }


参数|必须|说明
------|------|-------
sellerId|是|商户编码
storeId|是|是|门店编码
terminalId|是|终端编码
batchNo|是|批次号
terminalOrderId|是|终端流水号


2）返回说明

正常时的返回JSON数据包示例：

    {
        "product":[
            {
                "productId":"1010",
                "productName":"乐驾包5000", 
                "productPrice":450000,
                "remark":""
            },
            {
                "productId":"1011",
                "productName":"乐驾包4000", 
                "productPrice":350000,
                "remark":""
            },
            {
                "productId":"1012",
                "productName":"乐驾包2000", 
                "productPrice":150000,
                "remark":""
            }
        ]
        "request":"RESQUEST"
    }


参数|必须|说明
----|----|----
productId|是|产品编号
productName|是|产品名称
productPrice|是|产品价格，单位：分
remark|是|备注
request|是|原请求内容，必须和原来请求一样

