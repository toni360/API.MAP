
#目的

该文档是营销账户平台对外开放接口文档，用于对外开放折扣卡的线上开卡、线下开卡、和支付等能力。

>折扣卡说明
>所谓的折扣卡是指用一定金额购买价值某金额的卡，该卡上的金额只能在指定的商户、消费指定商品，不用用于其他用途，同时卡上金额不能转移。


#接口

##折扣卡系列接口


###线上开卡接口

该接口仅提供给**联动优势公司和深圳麦圈公司使用**，为用户开通折扣卡。

1）请求说明

前置条件：必须先执行获取短信验证码接口

http请求方式: post

    http://IP:PORT/front/discountCard/open?channel=C001


POST数据格式：JSON

    {
        "ID":"515411244445444444X", "name":"李四", "mobileNum":"13912345678", "smsCode":"4567", "channelOrderId":"channel1234567890", "productId":"1010"
    }


参数|必须|说明
------|------|-------
channel|是|渠道编码，中经汇通分配
ID|是|身份证号，要求以渠道秘钥，采用3DES加密后base64编码
name|是|姓名，要求以渠道秘钥，采用3DES加密后base64编码
mobileNum|是|开卡手机号码，要求以渠道秘钥，采用3DES加密后base64编码
smsCode|是|通过短信获取到的验证码
channelOrderId|是|渠道自定义订单号，用于异常时，查询开卡结果
productId|否|产品编号，不输入该参数，采用默认卡开卡

2）返回说明

正常时的返回JSON数据包示例：

    {
        "errcode":0,"errmsg":"用户开卡成功",
        "orderId":"12345678901234567890",
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "restAmount":40000,
            "balance":300000,
            "totalStages":3,
            "restStages":3,
            "returnSum":100000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"用户开卡失败，其它错误"
    }

参数|必须|说明
----|----|----
orderId|是|后台返回的订单号
accountId|是|折扣卡账号
amount|是|卡面额，单位：分
restAmount|是|卡剩余面额，单位：分
balance|是|卡当前可用金额，单位：分
totalStages|是|分期总数，如果分期数为0，表示该卡不用分期
restStage|是|剩余分期数
returnSum|是|分期金额，单位：分
startTime|是|有效期-开始日期
endTime|是|有效期-结束日期
status|是|状态，正常、冻结



###查询开卡结果接口

当开卡出现异常的时候，第三方应用系统可以使用该接口，检查开卡是否成功。

1）请求说明


http请求方式: post

    http://IP:PORT/front/discountCard/get?channel=C001


POST数据格式：JSON

    {
        "channelOrderId":"channel1234567890"
    }


参数|必须|说明
------|------|-------
channel|是|渠道编码
channelOrderId|是|需要查询开分期卡结果的渠道订单号，由于系统异常，第三方应用系统可能未接收到我方后台返回的订单号，因此采用第三方订单号查询，因此请第三方系统保证该值得唯一性。


2）返回说明

正常时的返回JSON数据包示例：

    {
        "orderId":"12345678901234567890",
        "card":{
            "accountId":"1234123412341234",
            "amount":400000,
            "restAmount":40000,
            "balance":300000,
            "totalStages":3,
            "restStages":3,
            "returnSum":100000,
            "startTime":"2015-01-01 00:00:00",
            "endTime":"2015-05-31 24:00:00",
            "status":"正常"
        }
    }

错误时的JSON数据包示例：

    {
        "errcode":10000,"errmsg":"没有查找到对应的分期卡订单，其它错误"
    }

参数|必须|说明
----|----|----
orderId|是|开卡的订单号
accountId|是|分期卡卡号
amount|是|分期卡面额，单位：分
restAmount|是|分期卡剩余面额，单位：分
balance|是|分期卡当前可用金额，单位：分
totalStages|是|分期总数
restStage|是|剩余分期数
returnSum|是|分期金额，单位：分
startTime|是|有效期-开始日期
endTime|是|有效期-结束日期
status|是|状态，正常、冻结



##线下系列

>**特别说明**
>线下系列对外接口与V1.1版本一样，不做任何修订，仅在内部实现做了调整。

###线下开卡接口

参见对外接口V1.1版本


###线下支付接口

参见对外接口V1.1版本

###线下交易撤销接口

参见对外接口V1.1版本


###线下交易冲正接口

参见对外接口V1.1版本


###线下查询余额接口

参见对外接口V1.1版本


###线下产品下载接口

参见对外接口V1.1版本



###同步系列接口

>**特别说明**
>线下系列对外接口与V1.1版本一样，不做任何修订，仅在内部实现做了调整。


###同步线下支付订单接口

参见对外接口V1.1版本


###同步线下开卡信息接口

参见对外接口V1.1版本





#对账

>**特别说明**
>线下系列对外接口与V1.1版本一样，不做任何修订，仅在内部实现做了调整。

##开卡对账

参见对外接口V1.1版本

##消费对账

参见对外接口V1.1版本

